<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CCC Culture Diagnostic Tool</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --card-bg: linear-gradient(180deg,#ffffff, #fdfbfb);
  --muted: #6b7280;
  --shadow: 0 8px 30px rgba(16,24,40,0.08);
  --accent: #4f46e5;
}

html,body{height:100%; margin:0;}

body {
  font-family: 'Inter', system-ui;
  background:#f3f4f6;
  padding:20px;
  color:#0f172a;
  overflow-x:hidden;
  display: flex;
  flex-direction: column; /* stack header and card vertically */
  align-items: center;    /* center horizontally */
}

.logo {
  max-width: 150px;
  height: auto;
  margin-bottom: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  border-radius: 8px;
}

@media(max-width:600px){
  .logo { max-width: 120px; margin-bottom: 12px; }
}
@media(max-width:400px){
  .logo { max-width: 90px; margin-bottom: 8px; }
}

.header {
  text-align: center;
  margin-bottom: 16px;
  max-width: 95vw;
}

.header h1 {
  font-size: 28px;
  font-weight: 700;
  margin: 0 0 8px 0;
}

.header p {
  font-size: 16px;
  color: var(--muted);
  margin: 0;
}

/* Responsive adjustments for header */
@media(max-width:600px){
  .header h1 { font-size: 22px; }
  .header p { font-size: 14px; }
}
@media(max-width:400px){
  .header h1 { font-size: 18px; }
  .header p { font-size: 12px; }
}

.card{
  width:760px;
  max-width:95vw;
  background:var(--card-bg);
  border-radius:16px;
  box-shadow:var(--shadow);
  padding:22px;
  display:flex;
  gap:24px;
  align-items:flex-start;
  flex-wrap:wrap;
}

.left{flex:none; padding:12px; min-width:0; width:100%;}
.right{flex:none; padding:8px 4px; min-width:0; width:100%;}

svg{
  width:100%;
  height:auto;
  max-height:260px;
}

.needle{
  stroke:#111827;
  stroke-width:4;
  stroke-linecap:round;
  transform-origin:50% 87.5%;
  transition: transform 800ms cubic-bezier(.2,.9,.2,1), stroke 300ms ease;
}
.center-circle{fill:#0f172a}
text.needle-value{font-size:24px;font-weight:700;fill:#111827;text-anchor:middle;dominant-baseline:middle;}

.value-badge{display:flex;align-items:center;gap:10px;margin-top:16px;justify-content:center;}
.score-pill{font-weight:700;padding:8px 12px;border-radius:999px;color:#111827}
.level-pill{padding:6px 10px;border-radius:999px;background:rgba(79,70,229,0.12);color:#4f46e5;font-weight:600}

/* Pillar bars */
.pillar-bar {margin:12px 0;}
.pillar-label {font-weight:600; margin-bottom:4px;}
.pillar-container {
  width:100%;
  height:20px;
  background:#e5e7eb;
  border-radius:10px;
  overflow:hidden;
  position: relative;
}
.pillar-fill {
  height:100%;
  width:0%;
  border-radius:10px;
  transition: width 0.8s, background 0.8s;
  position: relative;
}
.pillar-fill span {
  position: absolute;
  right:8px;
  top:50%;
  transform:translateY(-50%);
  font-weight:700;
  color:#111827;
  font-size:0.85rem;
  pointer-events:none;
}

/* Minor ticks and major numbers */
.tick{stroke:#374151;stroke-width:1.5;}
.major-number{font-size:16px;font-weight:600;fill:#374151;text-anchor:middle;dominant-baseline:middle;}

/* Recommendations */
#recommendations {margin-top:24px;width:100%;}
#recommendations h3 {font-size:18px;margin-bottom:12px;text-align:left;color: #111827;}
#recommendations ul {
  list-style:none;
  padding:0;
  margin:0;
  display:flex;
  flex-direction:column;
  gap:8px;
}
#recommendations li {
  background: #f3f4f6;
  padding:10px 14px;
  border-left:4px solid var(--accent);
  border-radius:6px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  font-weight:500;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
#recommendations li:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

/* Download button */
#downloadBtn {
  margin:16px;
  padding:10px 20px;
  border:none;
  background:#253551;
  color:white;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
  transition: background 0.2s ease;
}
#downloadBtn:hover { background:#3730a3; }

/* Responsive */
@media(max-width:900px){.card{padding:18px;} svg{max-height:220px;}}
@media(max-width:600px){
  .card{flex-direction:column;text-align:center;gap:16px;align-items:center;}
  .left, .right{padding:8px;width:100%;}
  svg{max-height:180px;}
  text.needle-value{font-size:20px;}
}
@media(max-width:400px){svg{max-height:140px;} text.needle-value{font-size:16px;}}
</style>
</head>
<body>

<!-- Logo -->
<img src="logo.png" alt="Company Logo" class="logo">

<div class="header">
  <h1>CCC Culture Diagnostic Tool</h1>
  <p>See a clear breakdown of your organization’s culture based on your responses.</p>
</div>

<!-- Download Button -->
<button id="downloadBtn">Download Report</button>

<div class="card">
  <div class="left">

    <svg viewBox="0 0 350 200">
      <defs>
        <linearGradient id="gaugeGradient" gradientUnits="userSpaceOnUse" x1="50" y1="175" x2="300" y2="175">
          <stop offset="0%" stop-color="#FF0000"/>
          <stop offset="75%" stop-color="#FFFF00"/>
          <stop offset="100%" stop-color="#00FF00"/>
        </linearGradient>
      </defs>

      <path d="M50,175 A125,125 0 0,1 300,175" stroke="url(#gaugeGradient)" fill="none" stroke-width="22" stroke-linecap="round"/>
      <g id="minorTicks"></g>
      <g id="majorNumbers"></g>
      <line x1="175" y1="175" x2="50" y2="175" class="needle" id="needle" />
      <circle cx="175" cy="175" r="7" class="center-circle" />
      <text id="needleValue" class="needle-value" x="175" y="145">—</text>
    </svg>

    <div class="value-badge">
      <div class="score-pill" id="scorePill">—</div>
      <div class="level-pill" id="levelPill">—</div>
    </div>

    <div id="recommendations">
      <h3>Top Recommendations</h3>
      <ul></ul>
    </div>
  </div>

  <div class="right">
    <div class="pillar-bar">
      <div class="pillar-label">Leadership</div>
      <div class="pillar-container"><div id="LeadershipFill" class="pillar-fill"><span>—</span></div></div>
    </div>
    <div class="pillar-bar">
      <div class="pillar-label">Accountability</div>
      <div class="pillar-container"><div id="AccountabilityFill" class="pillar-fill"><span>—</span></div></div>
    </div>
    <div class="pillar-bar">
      <div class="pillar-label">Speak-Up</div>
      <div class="pillar-container"><div id="SpeakUpFill" class="pillar-fill"><span>—</span></div></div>
    </div>
    <div class="pillar-bar">
      <div class="pillar-label">Risk Awareness</div>
      <div class="pillar-container"><div id="RiskAwarenessFill" class="pillar-fill"><span>—</span></div></div>
    </div>
  </div>
</div>

<!-- Libraries for download -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const fields = ['Leadership','Accountability','SpeakUp','RiskAwareness'];
const maxScore = 5;

const needle = document.getElementById("needle");
const scorePill = document.getElementById("scorePill");
const levelPill = document.getElementById("levelPill");
const needleValue = document.getElementById("needleValue");
const minorTicksGroup = document.getElementById("minorTicks");
const majorNumbersGroup = document.getElementById("majorNumbers");

/* ------------------------- LOAD REAL DATA ------------------------- */
function loadSavedData() {
  const stored = JSON.parse(localStorage.getItem("scores"));
  if (!stored) {
    console.warn("No cultureData found in localStorage.");
    return null;
  }
  return {
    Leadership: stored.leadership,
    Accountability: stored.accountability,
    SpeakUp: stored.speakup,
    RiskAwareness: stored.risk,
    overall: stored.overall
  };
}

/* ------------------------- TICKS / NUMBERS ------------------------- */
function drawMinorTicks(){
  const centerX=175, centerY=175, radius=125, tickLength=5;
  const minorSegments = 4;
  const totalTicks = (maxScore-1)*minorSegments;
  for(let i=1;i<totalTicks;i++){
    const angle=(180/totalTicks)*i;
    const rad=angle*Math.PI/180;
    const x1=centerX+(radius-tickLength)*Math.cos(rad);
    const y1=centerY-(radius-tickLength)*Math.sin(rad);
    const x2=centerX+radius*Math.cos(rad);
    const y2=centerY-radius*Math.sin(rad);
    const tick=document.createElementNS("http://www.w3.org/2000/svg","line");
    tick.setAttribute("x1",x1);
    tick.setAttribute("y1",y1);
    tick.setAttribute("x2",x2);
    tick.setAttribute("y2",y2);
    tick.setAttribute("class","tick");
    minorTicksGroup.appendChild(tick);
  }
}

function drawMajorNumbers(){
  const centerX=175, centerY=175, radius=125;
  const numberRadius = radius-25;
  const numbers=[1,2,3,4,5];
  numbers.forEach((num,i)=>{
    const angle=(i/(numbers.length-1))*180;
    const rad=angle*Math.PI/180;
    const x=centerX+numberRadius*Math.cos(rad-Math.PI);
    const y=centerY-numberRadius*Math.sin(rad);
    const text=document.createElementNS("http://www.w3.org/2000/svg","text");
    text.setAttribute("x",x);
    text.setAttribute("y",y);
    text.setAttribute("class","major-number");
    text.textContent=num;
    majorNumbersGroup.appendChild(text);
  });
}

/* ------------------------- COLOR & LEVELS ------------------------- */
function getGradientColor(avg){
  const t=(avg-1)/(maxScore-1);
  let r,g,b;
  if(t<=0.5){
    const p=t/0.5;
    r=255; g=Math.round(255*p); b=0;
  } else {
    const p=(t-0.5)/0.5;
    r=Math.round(255-255*p); g=255; b=0;
  }
  return `rgb(${r},${g},${b})`;
}

function computeLevel(avg){
  if(avg<2) return "Emerging";
  if(avg<3) return "Developing";
  if(avg<4) return "Established";
  return "Strategic";
}

/* ------------------------- ANIMATION ------------------------- */
function animateValue(el,start,end,duration){
  const range=end-start;
  let startTime=null;
  function step(timestamp){
    if(!startTime) startTime=timestamp;
    const progress=Math.min((timestamp-startTime)/duration,1);
    el.textContent=(start+range*progress).toFixed(2);
    if(progress<1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

/* ------------------------- RECOMMENDATIONS ------------------------- */
const recommendationBank={
  Leadership:["Strengthen visible leadership messaging","Increase leadership visibility in culture discussions"],
  Accountability:["Embed accountability in decision-making","Introduce culture-focused KPIs"],
  SpeakUp:["Strengthen psychological safety","Introduce confidential reporting channels"],
  RiskAwareness:["Reinforce early escalation","Increase visibility of follow-up actions"]
};

function renderRecommendations(data){
  const ul=document.querySelector("#recommendations ul");
  ul.innerHTML="";
  const sorted=Object.entries(data)
    .filter(([k])=>fields.includes(k))
    .sort((a,b)=>a[1]-b[1])
    .slice(0,3);

  const added = new Set();
  sorted.forEach(([pillar])=>{
    recommendationBank[pillar].forEach(rec=>{
      if(!added.has(rec)){
        const li=document.createElement("li");
        li.textContent=rec;
        ul.appendChild(li);
        added.add(rec);
      }
    });
  });
}

/* ------------------------- UPDATE UI ------------------------- */
function update(){
  const data=loadSavedData();
  if (!data) return;

  const deg=(data.overall-1)/(maxScore-1)*180;
  const needleColor=getGradientColor(data.overall);

  needle.style.transform=`rotate(${deg}deg)`;
  needle.style.stroke=needleColor;
  scorePill.style.background=needleColor;
  scorePill.style.color='#111827';

  animateValue(needleValue,0,data.overall,500);
  animateValue(scorePill,0,data.overall,500);
  levelPill.textContent = computeLevel(data.overall);

  const minFillPercent=5;
  fields.forEach(k=>{
    const val=data[k];
    const fill=document.getElementById(k+"Fill");
    const widthPercent=minFillPercent + ((val-1)/(maxScore-1))*(100 - minFillPercent);
    fill.style.width=widthPercent+"%";
    fill.style.background=getGradientColor(val);
    animateValue(fill.querySelector("span"),0,val,500);
  });

  renderRecommendations(data);
}

/* ------------------------- DOWNLOAD PDF (LOSSLESS & SMALLER) ------------------------- */
document.getElementById("downloadBtn").addEventListener("click", async () => {
  const card = document.querySelector(".card");

  // Reduce scale slightly for smaller file size but still clear
  const canvas = await html2canvas(card, { scale: 1.5, useCORS: true });

  // Convert to blob for more efficient memory usage
  canvas.toBlob((blob) => {
    const reader = new FileReader();
    reader.onload = function () {
      const imgData = reader.result;
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({
        orientation: canvas.width > canvas.height ? "landscape" : "portrait",
        unit: "px",
        format: [canvas.width, canvas.height]
      });
      pdf.addImage(imgData, "PNG", 0, 0, canvas.width, canvas.height);
      pdf.save("Culture_Report.pdf");
    };
    reader.readAsDataURL(blob);
  }, "image/png", 1.0);
});

/* ------------------------- INIT ------------------------- */
drawMinorTicks();
drawMajorNumbers();
update();
</script>



</body>
</html>
